@startuml borrarPresupuesto
|Administrador|
start 
:Ha ejecutado con éxito el CU Buscar avanzado presupuestos;
repeat
:Seleccionado el presupuesto que desea borrar;
repeat while(El presupuesto se encuentra en estado "Vendido") is (V)
|ZMGestion|
:Borra el presupuesto y muestra un mensaje indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml borrarProducto
|Administrador|
start
:Ha ejecutado con exito el CU Buscar productos avanzado;
repeat
:Indica el producto que quiere borrar;
repeat while(El producto fue utilizado para crear un producto final) is (V)
|ZMGestion|
:Borra el producto y muestra un mensaje indicando el éxito de la 
operación;
|Administrador|
end
@enduml

@startuml borrarTela
|Administrador|
:Ha ejecutado con éxito el CU Listar telas;
repeat
:Indica la tela que desea borrar;
repeat while(La tela fue utilizada para crear al menos un producto final) is (V)
|ZMGestion|
:Borra la tela y muestra un mensaje indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml buscarAvanzadoClientes
|Vendedor|
:Accede a la pantalla para buscar clientes;
|ZMGestion|
repeat
:Muestra un formulario para que el vendedor ingrese la cadena de busqueda,
seleccione el tipo de persona y decida si desea buscar clientes dados de baja;
|Vendedor|
:Completa el formulario;
|ZMGestion|
repeat while(No se econtro ningun resultado para la busqueda) is (V)
:Lista las coincidencias encontradas;
|Vendedor|
end
@enduml

@startuml buscarAvanzadoPresupuestos
|Vendedor|
start
:Accede a la pantalla para buscar presupuestos;
|ZMGestion|
repeat
:Muestra un formulario para que el vendedor seleccione un cliente, producto, tela,
lustre y estado del presupuesto. Siendo todos los campos opcionales;
|Vendedor|
:Completa los campos seleccionados;
|ZMGestion|
:Busca por cliente, producto, tela, lustre y estado del presupuesto;
repeat while(Hay al menos una coincidencia) is (F)
:Lista las coincidencias encontradas;
|Vendedor|
end
@enduml

@startuml buscarAvanzadoProductos
|Vendedor|
start
:Accede a la pantalla para buscar productos;
|ZMGestion|
repeat
:Muestra un formulario para que el vendedor ingrese la cadena de busqueda,
elegir grupo y categoría de producto y si se desea 
buscar prodcutos dados de baja;
|Vendedor|
:Completa los campos solicitados;
|ZMGestion| 
:Busca por nombre de producto, grupo y categoría y estado;
repeat while(No se encontraron coincidencias) is (V)
:Lista las coincidencias encontradas;
|Vendedor|
end
@enduml

@startuml crearCliente
|Vendedor|
start
:Accede a la pantalla para crear clientes;
|ZMGestion|
repeat
repeat
repeat
:Muestra un formulario para que el vendedor ingrese el tipo de persona (física o jurídica),
nombre y apellido (o razón social), tipo y número de docuemento, correo electrónico, número de
telefono y nacionalidad;
|Vendedor|
:Completa el formulario;
|ZMGestion|
repeat while(El vendedor ha dejado un campo obligatorio vacio) is (V)
repeat while(El correo electrónico ingresado ya esta en uso) is (V)
repeat while(El tipo y número de documento ingresado ya existe) is (V)
:Crea el cliente y muestra un mensaje indicando el éxito de la operación;
|Vendedor|
end
@enduml

@startuml crearPresupuesto
|Vendedor|
start
:Accede a la pantalla para crear presupuestos;
|ZMGestion|
repeat
:Muestra un formulario para que el vendedor seleccione un cliente y un campo autocompletado
con el perido de validez, que podrá modificar si cuenta con los permisos.;
|Vendedor|
:Selecciona un cliente y modifica el periodo de validez;
|ZMGestion|
repeat while(Ha seleccionado un cliente) is (F)
:Crea un presupuesto en estado de "En creación";
repeat
|Vendedor|
if(Desea agregar una linea de presupuesto) then (V)
:Ejecuta el CU064(Crear linea de presupuesto)|
else if (Desea modificar una linea de presupuesto) then (V)
:Ejecuta el CU065(Modificar linea de presupuesto)|
else if (Desea quitar una linea de presupuesto) then (V)
:Ejecuta el CU066(Modificar linea de presupuesto)|
endif
repeat while(Ha ingresado al menos una linea de presupuesto) is (F)
|ZMGestion|
:Cambia el estado del presupuesto a "Creado";
|Vendedor|
end
@enduml

@startuml crearProducto
|Administrador|
start
:Ingresa a la pantalla para crear productos;
|ZMGestion|
repeat
repeat
repeat
:Muestra un formulario para ingresar el nombre del 
producto, el precio, la cantidad de tela necesaria para
producirlo en caso de ser necesario y dos listas desplegables
para seleccionar la categoría y el grupo al cual pertenece
el producto;
|Administrador|
:Completa el formulario y selecciona de las listas desplegables
el grupo y categoría a la cual pertenece el producto;
|ZMGestion|
repeat while(El nombre ingresado ya existe para el grupo y categoria) is (V)
repeat while(El precio ingresado sea menor o igual a cero) is (V)
repeat while(La cantidad de tela necesaria ingresada sea menor a cero) is (V)
:Crea el producto con los campos ingresados por el usuario y 
 muestra un mensaje indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml crearProductoFinal
|Vendedor|
start
:Ingresa a la pantalla para crear productos finales;
|ZMGestion|
repeat
:Muestra un formulario para seleccionar el producto,
tipo de producto, tela y lustre;
|Vendedor|
:Selecciona el producto, tipo de producto, tela y lustre;
|ZMGestion|
repeat while(Un producto final ya existe con dicho producto, tipo de producto, tela y lustre.) is (V)
:Crea el producto final con los campos ingresados por el vendedor y 
 muestra un mensaje indicando el éxito de la operación;
|Vendedor|
end
@enduml

@startuml crearRol
|Administrador|
start
:Accede la la pantalla para crear roles;
|ZMGestion|
repeat
repeat
:Muestra un formulario para que el administador ingrese el nombre del rol
y seleccione los permisos que desea otorgarle. Indicando que ambos campos
son obligatorios;
|Administrador|
:Completa los campos requeridos;
|ZMGestion|
repeat while(Alguno de los campos obligatorios se encuentra vacio) is (V)
repeat while(El nombre ingresado ya esta en uso) is (V)
:Crea el rol y muestra un mensaje indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml crearTela
|Administrador|
start 
:Accede a la pantalla para crear telas;
|ZMGestion|
repeat
repeat
repeat
:Muestra un formulario para que el usuario ingrese
el nombre y el precio por metro de tela. Indicando que
ambos campos son obligatorios;
|Administrador|
:Completa los campos requeridos;
|ZMGestion|
repeat while(Alguno de los campos obligatorios se encuentra vacio) is (V)
repeat while(El nombre ingresado ya se encuentra en uso) is (V)
repeat while(El precio ingresado sea menor o igual que cero) is (V)
:Crea la tela y muestra un mensaje 
indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml crearVenta
|Vendendor|
start
:Accede a la pantalla para crear ventas;
|ZMGestion|
repeat
:Muestra un formulario para que el vendendor seleccione un cliente;
|Vendendor|
:Selecciona un cliente;
|ZMGestion|
repeat while(No se ha seleccionado ningún cliente) is (V)
:Crea la venta en estado 'En creación' para el cliente seleccionado;
|Vendendor|
repeat
if(Desea agregar una linea de venta) then (V)
:Ejecuta el CU074(Crear linea de venta)|
else if (Desea quitar una linea de venta) then (V)
:Ejecuta el CU075(Modificar linea de venta)|
else if (Desea quitar una linea de venta) then (V)
:Ejecuta el CU076(Borrar linea de venta)|
endif
repeat while(No se ha agregado ninguna linea de venta) is (V)
|ZMGestion|
if(Todas las lineas de venta tienen el precio actual de los productos) then (V)
:Pasa el estado de la venta a 'Pendiente';
else (F)
:Pasa el estado de la venta a 'En revisión';
endif
|Vendendor|
end
@enduml

@startuml crearOrdenProduccion
|Administrador|
start
:Accede a la panatalla para crear órdenes de producción;
|ZMGestion|
:Crea una orden de producción en estado de `En creación';
|Administrador|
if(Desea agregar una linea de orden de producción) then (V)
:Ejecuta el CU103(Crear linea de orden de producción)|
else if (Desea quitar una linea de orden de producción) then (V)
:Ejecuta el CU104(Modificar linea de orden de producción)|
else if (Desea quitar una linea de orden de producción) then (V)
:Ejecuta el CU105(Borrar linea de orden de producción)|
endif
|ZMGestion|
if (Se agrego al menos una linea de orden de producción) then (V)
:Crea el estado de la orden de producción a `Pendiente';
endif
|Administrador|
end
@enduml 

@startuml crearLineaOrdenProduccion
|Administrador|
start 
:Desea agregar una linea de orden de producción;
|ZMGestion|
repeat
repeat
:Muestra un formulario para que el administrador seleccione el producto, tela y lustre
junto con la cantidad que desea producir del mismo;
|Administrador|
:Selecciona el producto, tela, lustre y cantidad a producir;
|ZMGestion|
repeat while (La cantidad ingresada es menor o igual que cero) is (V)
repeat while (El producto, tela y lustre indicado ya se encuentra en la orden de producción)
if(Si la combinacion de producto, tela y lustre no existe) then (V)
:Ejecuta el CU025(Crear producto final) para el producto, tela y lustre seleccionado|
endif
:Crea la linea de orden de producción en estado de 'Pendiente de producción' 
y la asociacia a la orden de produción correspondiente;
|Administrador|
end

@enduml

@startuml darAltaTela
|Administrador|
start
:Ha ejecutado con éxito el CU Listar telas;
repeat
:Indica la tela que quiere dar de alta;
repeat while (La tela ya se encuentra en el estado de Alta) is (V)
|ZMGestion|
:Da de alta la tela y muesta un mensaje indicando el 
éxito de la operación;
|Administrador|
end
@enduml

@startuml darAltaProducto
|Administrador|
start
:Ha ejecutado con exito el CU Buscar avanzado productos;
repeat
:Indica el producto que quiere dar de alta;
repeat while(El producto ya se encuentra en estado de Alta) is (V)
|ZMGestion|
:Da de alta el producto indicado y muestra un mensaje 
indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml darBajaTela
|Administrador|
start 
:Ha ejecutado con exito el CU Listar telas;
repeat
:Indica la tela que desea dar de baja;
repeat while(La tela ya se encuentra en estado Baja) is (V)
|ZMGestion|
:Da de baja la tela y muestra un mensaje indicando que
la operación se realizo con éxito;
|Administrador|
end
@enduml

@startuml darBajaProducto
|Administrador|
start
:Ha ejecutado con éxito el CU BuscarAvanzadoProductos;
repeat
:Selecciona el producto que desea dar de baja;
repeat while(El producto ya se encuentra en estado de baja) is (V)
|ZMGestion|
:Da de baja el producto y muestra un mensaje indicando el éxito de la operación;
|Administrador|
end
@enduml

@startuml enviarPresupuestoEmail
|Vendedor|
:Ha ejecutado con éxito el CU Buscar avanzado presupuestos;
repeat
:Selecciona el presupuesto que desea enviar por correo electrónico;
|ZMGestion|
:Genera en formato PDF el presupuesto;
repeat while(Ël cliente no posee un correo electrónico) is (V)
:Envia el presupuesto por correo electrónico al correo del cliente asociado al presupuesto;
|Vendedor|
end
@enduml

@startuml generarPresupuestoPDF
|Vendedor|
start
:Ha ejecutado con éxito el CU Buscar avanzado presupuestos;
:Selecciona el presupuesto para generarlo en formato PDF;
|ZMGestion|
:Genera un achivo con formato PDF con los datos del presupuesto;
|Vendedor|
end
@enduml

@startuml iniciarSesion
|Usuario|
start
:Ingresa la dirección de la aplicación en un dispositivo
conectado a Internet;
|ZMGestion|
repeat
repeat
repeat
:Muestra un formulario para que el usuario ingrese su
nombre de usuario y contraseña;
|Usuario|
:El usuario introduce su nombre de usuario y contraseña;
|ZMGestion|
repeat while(El nombre de usuario ingresado existe) is (F)
repeat while(El usuario se encuentra activo) is (F)
repeat while(La contraseña ingresada es incorrecta 
y no supero el limite de intentos permitidos) is (V)
if(La contraseña ingresada es incorrecta 
y supero el limite de intentos permitidos ) then (V)
:Bloquea al usuario;
else (F)
:Genera el token de sesión y lo almacena;
:Trae los permisos del usuario y le muestra sus opciones;
endif
|Usuario|
end
@enduml

@startuml listarLineasPresupuesto
|Vendedor|
start
:He ejecutado con éxito el CU Buscar avanzado presupuesto;
repeat
:Indica el presupuesto del cual desea listar las lineas de presupuesto;
repeat while(El presupuesto no posee lineas de presupuesto) is (V)
|ZMGestion|
:Lista las lineas de presupuesto;
|Vendedor|
end
@enduml

@startuml listarTelas
|Vendedor|
start
:Accede a la pantalla para listar las telas;
|ZMGestion|
if(Existe alguna tela en el sistema) then (V)
:Muestra una lista con las telas existentes;
else (F)
:Muestra un mensaje indicando que no existe ninguna tela;
endif
|Vendedor|
end
@enduml

@startuml modificarPresupuesto
|Vendedor|
start 
:Ha ejecutado con éxito el CU Buscar avanzado presupuestos;
repeat
repeat
:Selecciona el presupuesto que desea modificar;
repeat while(El presupuesto se encuentra en estado "Vendido")
repeat while (El vendedor que esta intentando modificar el presupuesto no es administrador 
y el presupuesto no le pertenece)
|ZMGestion|
repeat
repeat
:Muestra un formulario autocompletado con el cliente y periodo de validez del presupuesto,
si cuenta con los permisos podra modifica el periodo de validez;
|Vendedor|
:Modifica el cliente y periodo de validez;
|ZMGestion|
repeat while(El vendedor ha dejado alguno de los campos vacios) is (V)
repeat while(El vendedor ha modificado el periodo de validez y no tiene permisos) is (V)
:Ejecuta el CU058(Listar lineas de presupuesto) para el presupuesto seleccionado|
|Vendedor|
if(Desdea agregar una linea de presupuesto) then (V)
:Ejecuta el CU059(Crear linea de presupuesto)|
else if  (Desea modificar una linea de presupuesto) then (V)
:Ejecuta el CU060(Modificar linea de presupuesto)|
else if (Desea borrar una linea de presupuesto) then (V)
:Ejecuta el CU061(Borrar linea de presupuesto)|
endif
|ZMGestion|
:Modifica el presupuesto seleccionado y muestra un mensaje indicando el éxito de la operación;
|Vendedor|
end
@enduml

@startuml modificarProducto
|Administrador|
start
:Ha ejecutado el CU BuscarAvanzadoProducto con éxito;
:Selecciona el producto que desea modificar;
|ZMGestion|
repeat
repeat
repeat
repeat
:Muestra un formulario autocompletado con los datos del producto
seleccionado;
|Administrador|
:Modifica los campos que desea cambiar;
|ZMGestion|
repeat while(El nombre, grupo y categoría ingresados ya estan en uso)
repeat while(El precio es menor o igual que cero)
repeat while(La cantidad de tela necesaria es menor que cero)
repeat while(Alguno de los campos requeridos está vacio)
:Modifica el producto con los datos ingresados y muestra un mensaje de éxito;
|Administrador|
end
@enduml

@startuml modificarTela
|Administrador|
:Ha ejecutado con éxito el CU Listar telas;
:Indica la tela que desea modificar;
|ZMGestion|
repeat
repeat
repeat
:Muestra un formulario autocompletado con los datos de la tela seleccionada
para que el administrador modifique: nombre y precio por metro de la tela.
Indicando que ambos campos son obligatorios;
|Administrador|
:Modifica los campos que desea cambiar;
|ZMGestion|
repeat while(El nombre de la tela se encuentra en uso) is (V)
repeat while(El precio ingresado es menor o igual a cero) is (V)
repeat while(Al menos un campo requerido está vacio) is (V)
:Modifica la tela y muestra un mensaje indicando
el éxito de la operación;
|Administrador|
end
@enduml

@startuml modificarVenta
|Vendedor|
start 
:Ha ejecutado con éxito el CU063(Buscar avanzado ventas);
repeat
repeat
:Selecciona la venta que desea modificar;
repeat while(La venta no se encuentra en estado 'En creación') is (V)
repeat while (El vendedor que esta intentando modificar la venta no es administrador 
y la venta no le pertenece)
|ZMGestion|
repeat
:Muestra un formulario autocompletado con el cliente.;
|Vendedor|
:Modifica el cliente;
|ZMGestion|
repeat while(El vendedor ha dejado el cliente vacio) is (V)
:Ejecuta el CU064(Listar lineas de venta) para la venta seleccionada|
|Vendedor|
if(Desdea agregar una linea de venta) then (V)
:Ejecuta el CU067(Crear linea de venta)|
else if  (Desea modificar una linea de venta) then (V)
:Ejecuta el CU068(Modificar linea de venta)|
else if (Desea borrar una linea de venta) then (V)
:Ejecuta el CU069(Borrar linea de venta)|
endif
|ZMGestion|
:Modifica la venta seleccionada y muestra un mensaje indicando el éxito de la operación;
|Vendedor|
end
@enduml

@startuml transformarPresupuestoEnVenta
|Vendedor|
start
:Ha ejecutado con éxito el CU052(Buscar avanzado presupuestos);
repeat
:Selecciona el/los presupuesto/s a partir de los cuales desea generar la venta;
repeat while(Al menos un presupuesto seleccionado se encuentra en estado de "Vendido") is (V)
|ZMGestion|
repeat
:Muestra un formulario para que el vendedor seleccione
el cliente y ejecuta el CU058(Listar lineas de presupuesto)
para cada presupuesto seleccionado, mostrando una opción por
cada linea si desea añadirla a la venta ;
|Vendedor|
:Selecciona el cliente y elige las lineas de presupuesto que desea agregar;
|ZMGestion|
repeat while(El vendedor ha dejado el cliente vacio) is (V)
:Crea un venta para el cliente seleccionado en estado de "En creación"
y ejecuta el CU067(Crear linea de venta) con los valores de producto, cantidad 
y precio de cada linea de presupuesto seleccionada;
|Vendedor|
repeat
if (Desea modificar una linea de venta) then (V)
:Ejecuta el CU075(Modificar linea de venta)|
else if (Desdea agregar una linea de venta) then (V)
:Ejecuta el CU074(Crear linea de venta)|
else if (Desea quitar alguna linea de venta agregada) then (V)
:Ejecuta el CU076(Borrar linea de venta)|
endif
repeat while(La venta no tiene ninguna linea de venta asociada) is (V)
|ZMGestion|
if(Todas las lineas de venta tienen el precio actual de los productos) then (V)
:Pasa el estado de la venta a 'Pendiente';
:Pasa el estado de la lineas de presupuesto utilizadas a `Utilizada' y de las no utilizadas a `No utilizada';
else (F)
:Pasa el estado de la venta a 'En revisión';
endif
|Vendedor|
end
@enduml